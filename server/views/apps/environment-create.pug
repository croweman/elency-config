doctype html
html(lang='en')

  include ../mixins/input-group.pug
  include ../includes/head.pug

  body

    include ../includes/nav-bar.pug

    #top.jumbotron
      .container
        h2.display-6 App Environment

    .container

      div.row
        div.col-md-5
          strong Team Id:
          - url = '/team/' + app.teamId
          span.info-value
            a(href=url)= app.teamId
        div.col-md-5
          strong App Id:
          - url = '/team/' + app.teamId + '/app/' + app.appId
          span.info-value
            a(href=url)= app.appId
        div.col-md-5
          strong Team Name:
          span.info-value= app.teamName
        div.col-md-5
          strong App Name:
          span.info-value= app.appName

        div.breaker
          | &nbsp;

      form

        input#teamid.input(style='display:none', value=app.teamId)
        input#appid.input(style='display:none', value=app.appId)
        +inputGroup('environment', 'Environment')(autocomplete='off', data-minlength='1', data-errormessage='Environment must be at least 1 character and contain characters (a-zA-Z0-9_-)', data-regex='^[a-zA-Z0-9\_\-]+$')

        #keyId-form-group.form-group
          label.form-control-label(for='password') Encrypted config item encryption key
          select#keyId.form-control(, data-minlength='1', data-errormessage='You must select an encryption key')
            option(value="") Please select
            each key in keys
              option(value=key.keyId)= key.keyName + ' - ' + key.keyId
          #key-info.form-control-feedback

        #JSONSchema-form-group.form-group
            label.form-control-label(for='JSONSchema') JSON Schema
            textarea.form-control(id='JSONSchema', cols='2', rows='5', value='', placeholder='Optional, must be a valid JSON Schema')
            .form-control-feedback(id='JSONSchema-info')

        h3.breaker Configuration inheritance

        div.form-group.col-md-12
          div 
            | By default when inheritance is allowed and no teams/apps are specified any app in the same environment can inherit the configuration!
          br
          div.form-check
            label.form-check-label
              input#allowInheritance.form-check-input(type="checkbox")
              |  Allow inheritance
          div#inheritance-rules-hidden

            div.panel.panel-default.permissions.col-md-12
              div.permissions-heading
                | Teams
              div#team-inheritance

              #add-team.form-group.col-md-12.team
                label.form-control-label(for='team') Add a team:
                input#team.typeahead.form-control.col-md-8(type='text', autocomplete='off', placeholder="Select a team", value='', data-errormessage="Select a valid team")
                #team-info.form-control-feedback

            div.panel.panel-default.permissions.col-md-12
              div.permissions-heading
                | Apps
              div#app-inheritance

              #add-app.form-group.col-md-12.team
                label.form-control-label(for='app') Add an app:
                input#app.typeahead.form-control.col-md-8(type='text', autocomplete='off', placeholder="Select an app", value='', data-errormessage="Select a valid app")
                #app-info.form-control-feedback
          
        div.text-right
          button#createAppEnvironment.btn.btn-primary(type="submit", data-loading-text="<i class='icon-spinner icon-spin'></i> Creating app environment") Create app environment

        include ../includes/error-box.pug

      include ../includes/footer.pug

    include ../includes/scripts.pug

    script(type='text/javascript').
      var availableTeams = !{JSON.stringify(teams)};
      var availableApps = !{JSON.stringify(apps)};
      var teamInheritanceIndex = 0;
      var appInheritanceIndex = 0;

      $(function() {
          elencyConfig.createAppEnvironment();
      });